<html>

<head>

<title></title>
<script type="text/javascript" src="../../conf.js"></script>
<script type="text/javascript" src="../../scripts/function.js"></script>
<script type="text/javascript" src="../../scripts/crypto.js"></script>
<script type="text/javascript" src="../../scripts/sha1.js"></script>
<script type="text/javascript" src="../../scripts/hmac.js"></script>
<script type="text/javascript" src="../../scripts/OAuth.js"></script>
</head>

<body>
<script type="text/javascript">
/*第一次回调此页面的url为
http://www.myurl.com/example?code=CODE&openid=OPENID&openkey=OPENKEY
第二次回调返回的值为
access_token=ACCESS_TOKEN&expires_in=60&refresh_token=REFRESH_TOKEN
*/
/*请求access_token的url
https://open.t.qq.com/cgi-bin/oauth2/access_token?client_id=APP_KEY&client_secret=APP_SECRET&redirect_uri=http://www.myurl.com/example&grant_type=authorization_code&code=CODE*/

var client_id=qqweibo_key;
var client_secret=qqweibo_secret;
var redirect_uri=qqweibo_redirect;
var grant_type="authorization_code";

var code=getQueryString("code");  
var openid=getQueryString("openid"); 
var openkey=getQueryString("openkey"); 

var url="https://open.t.qq.com/cgi-bin/oauth2/access_token?";
var request_parameter="client_id="+client_id+"&"+"client_secret="+client_secret+"&"+"redirect_uri="+redirect_uri+"&"+"grant_type=authorization_code&code="+code;

var result=getContent(url+request_parameter,proxy);
var access_token=splitParameter(result,'0');
var expires_in=splitParameter(result,'1');
var refresh_token=splitParameter(result,'2');;


document.write("loading...");
/*
document.write("result:");
document.write(result);
document.write("qqweibo_key:");
document.write(qqweibo_key);
document.write("qqweibo_secret:");
document.write(qqweibo_secret);
document.write("code=");
document.write(code);
document.write("openid=");
document.write(openid);
document.write("openkey=");
document.write(openkey);
document.write("access_token=");
document.write(access_token);
document.write("expires_in");
document.write(expires_in);
document.write("refresh_token=");
document.write(refresh_token);
*/

</script>


<script type="text/javascript">
window.location.href="http://"+ccHost+":"+ccPort+"/"+ccWiki+"/includes/snsLogin.php?sns=qqweibo&access_token="+access_token+"&openid="+openid+"&openkey="+openkey+"&expires_in="+expires_in+"&refresh_token="+refresh_token;
</script>


</body>

</html>
